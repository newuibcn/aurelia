System.register(['aurelia-framework'], function(exports_1) {
    var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
        if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
        else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __metadata = (this && this.__metadata) || function (k, v) {
        if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
    };
    var aurelia_framework_1;
    var PackerCustomElement;
    return {
        setters:[
            function (aurelia_framework_1_1) {
                aurelia_framework_1 = aurelia_framework_1_1;
            }],
        execute: function() {
            PackerCustomElement = (function () {
                function PackerCustomElement(_element) {
                    this._element = _element;
                    this.sorter = {
                        random: function (a, b) {
                            return Math.random() - 0.5;
                        },
                        w: function (a, b) {
                            return b.w - a.w;
                        },
                        h: function (a, b) {
                            return b.h - a.h;
                        },
                        a: function (a, b) {
                            return b.area - a.area;
                        },
                        max: function (a, b) {
                            return Math.max(b.w, b.h) - Math.max(a.w, a.h);
                        },
                        min: function (a, b) {
                            return Math.min(b.w, b.h) - Math.min(a.w, a.h);
                        },
                        height: (function (a, b) {
                            return this.sorter.msort(a, b, ['h', 'w']);
                        }).bind(this),
                        width: (function (a, b) {
                            return this.sorter.msort(a, b, ['w', 'h']);
                        }).bind(this),
                        area: (function (a, b) {
                            return this.sorter.msort(a, b, ['a', 'h', 'w']);
                        }).bind(this),
                        maxside: (function (a, b) {
                            return this.sorter.msort(a, b, ['max', 'min', 'h', 'w']);
                        }).bind(this),
                        msort: (function (a, b, criteria) {
                            var diff, n;
                            for (n = 0; n < criteria.length; n++) {
                                diff = this.sorter[criteria[n]](a, b);
                                if (diff != 0)
                                    return diff;
                            }
                            return 0;
                        }).bind(this),
                        now: function (blocks) {
                            blocks.sort(this.maxside);
                        }
                    };
                }
                PackerCustomElement.prototype.attached = function () {
                    this.root = { x: 0, y: 0, w: $(this._element).width(), h: $(this._element).height() };
                    this.fit(this.getTiles(this._element.getElementsByTagName('paper-card')));
                };
                PackerCustomElement.prototype.getTiles = function (elements) {
                    var tile, tiles = [];
                    for (var i = 0; i < elements.length; i++) {
                        tile = { node: elements[i], w: $(elements[i]).width(), h: $(elements[i]).height() };
                        tiles.push(tile);
                    }
                    tiles.sort(function (a, b) {
                        return a.h > b.h ? 1 :
                            a.h < b.h ? -1 : 0;
                    });
                    return tiles;
                };
                PackerCustomElement.prototype.fit = function (tiles) {
                    var n, node, tile;
                    this.root = { x: 0, y: 0, w: tiles[0].w, h: tiles[0].h };
                    for (n = 0; n < tiles.length; n++) {
                        tile = tiles[n];
                        if (node = this.findNode(this.root, tile.w, tile.h)) {
                            tile.fit = this.splitNode(node, tile.w, tile.h);
                        }
                        else {
                            tile.fit = this.growNode(tile.w, tile.h);
                        }
                    }
                    for (var n = 0; n < tiles.length; n++) {
                        var tile = tiles[n];
                        if (tile.fit) {
                            var parentOffset = $(this._element).offset();
                            $(tile.node).offset({ left: parentOffset.left + tile.fit.x, top: parentOffset.top + tile.fit.y });
                        }
                    }
                };
                PackerCustomElement.prototype.growNode = function (w, h) {
                    var canGrowDown = (w <= this.root.w);
                    var canGrowRight = (h <= this.root.h);
                    var shouldGrowRight = canGrowRight && (this.root.h >= (this.root.w + w));
                    var shouldGrowDown = canGrowDown && (this.root.w >= (this.root.h + h));
                    if (shouldGrowRight)
                        return this.growRight(w, h);
                    else if (shouldGrowDown)
                        return this.growDown(w, h);
                    else if (canGrowRight)
                        return this.growRight(w, h);
                    else if (canGrowDown)
                        return this.growDown(w, h);
                    else
                        return null;
                };
                PackerCustomElement.prototype.growRight = function (w, h) {
                    var node;
                    this.root = {
                        used: true,
                        x: 0,
                        y: 0,
                        w: this.root.w + w,
                        h: this.root.h,
                        down: this.root,
                        right: { x: this.root.w, y: 0, w: w, h: this.root.h }
                    };
                    if (node = this.findNode(this.root, w, h))
                        return this.splitNode(node, w, h);
                    else
                        return null;
                };
                PackerCustomElement.prototype.growDown = function (w, h) {
                    var node;
                    this.root = {
                        used: true,
                        x: 0,
                        y: 0,
                        w: this.root.w,
                        h: this.root.h + h,
                        down: { x: 0, y: this.root.h, w: this.root.w, h: h },
                        right: this.root
                    };
                    if (node = this.findNode(this.root, w, h))
                        return this.splitNode(node, w, h);
                    else
                        return null;
                };
                PackerCustomElement.prototype.findNode = function (root, w, h) {
                    if (root.used)
                        return this.findNode(root.right, w, h) || this.findNode(root.down, w, h);
                    else if ((w <= root.w) && (h <= root.h))
                        return root;
                    else
                        return null;
                };
                PackerCustomElement.prototype.splitNode = function (node, w, h) {
                    node.used = true;
                    node.down = { x: node.x, y: node.y + h, w: node.w, h: node.h - h };
                    node.right = { x: node.x + w, y: node.y, w: node.w - w, h: h };
                    return node;
                };
                PackerCustomElement = __decorate([
                    aurelia_framework_1.customAttribute('packer'),
                    aurelia_framework_1.autoinject, 
                    __metadata('design:paramtypes', [Element])
                ], PackerCustomElement);
                return PackerCustomElement;
            })();
            exports_1("PackerCustomElement", PackerCustomElement);
        }
    }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvY29tcG9uZW50cy9hdHRyaWJ1dGVzL3BhY2tlci50cyJdLCJuYW1lcyI6WyJQYWNrZXJDdXN0b21FbGVtZW50IiwiUGFja2VyQ3VzdG9tRWxlbWVudC5jb25zdHJ1Y3RvciIsIlBhY2tlckN1c3RvbUVsZW1lbnQuYXR0YWNoZWQiLCJQYWNrZXJDdXN0b21FbGVtZW50LmdldFRpbGVzIiwiUGFja2VyQ3VzdG9tRWxlbWVudC5maXQiLCJQYWNrZXJDdXN0b21FbGVtZW50Lmdyb3dOb2RlIiwiUGFja2VyQ3VzdG9tRWxlbWVudC5ncm93UmlnaHQiLCJQYWNrZXJDdXN0b21FbGVtZW50Lmdyb3dEb3duIiwiUGFja2VyQ3VzdG9tRWxlbWVudC5maW5kTm9kZSIsIlBhY2tlckN1c3RvbUVsZW1lbnQuc3BsaXROb2RlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7WUFLQTtnQkF1RElBLDZCQUFvQkEsUUFBaUJBO29CQUFqQkMsYUFBUUEsR0FBUkEsUUFBUUEsQ0FBU0E7b0JBakQ5QkEsV0FBTUEsR0FBR0E7d0JBRVpBLE1BQU1BLEVBQUVBLFVBQVVBLENBQUNBLEVBQUVBLENBQUNBOzRCQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQzt3QkFDL0IsQ0FBQzt3QkFDREEsQ0FBQ0EsRUFBRUEsVUFBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7NEJBQ2IsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDckIsQ0FBQzt3QkFDREEsQ0FBQ0EsRUFBRUEsVUFBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7NEJBQ2IsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDckIsQ0FBQzt3QkFDREEsQ0FBQ0EsRUFBRUEsVUFBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7NEJBQ2IsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQzt3QkFDM0IsQ0FBQzt3QkFDREEsR0FBR0EsRUFBRUEsVUFBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7NEJBQ2YsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDbkQsQ0FBQzt3QkFDREEsR0FBR0EsRUFBRUEsVUFBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7NEJBQ2YsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDbkQsQ0FBQzt3QkFFREEsTUFBTUEsRUFBRUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7NEJBQ25CLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7d0JBQy9DLENBQUMsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7d0JBQ2JBLEtBQUtBLEVBQUVBLENBQUNBLFVBQVVBLENBQUNBLEVBQUVBLENBQUNBOzRCQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUMvQyxDQUFDLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO3dCQUNiQSxJQUFJQSxFQUFFQSxDQUFDQSxVQUFVQSxDQUFDQSxFQUFFQSxDQUFDQTs0QkFDakIsTUFBTSxDQUFDLElBQUksQ0FB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QSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDcERBLENBQUNBO3dCQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTs0QkFDSkEsSUFBSUEsQ0FBQ0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQzdDQSxDQUFDQTtvQkFDTEEsQ0FBQ0E7b0JBRURBLEdBQUdBLENBQUFBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUdBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO3dCQUNyQ0EsSUFBSUEsSUFBSUEsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQ3BCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTs0QkFDWEEsSUFBSUEsWUFBWUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7NEJBQzdDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFDQSxJQUFJQSxFQUFFQSxZQUFZQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxZQUFZQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxFQUFDQSxDQUFDQSxDQUFDQTt3QkFDcEdBLENBQUNBO29CQUNMQSxDQUFDQTtnQkFDTEEsQ0FBQ0E7Z0JBRU9KLHNDQUFRQSxHQUFoQkEsVUFBaUJBLENBQUNBLEVBQUVB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aEJBLFVBQWlCQSxDQUFDQSxFQUFFQSxDQUFDQTtvQkFDakJPLElBQUlBLElBQUlBLENBQUNBO29CQUNUQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQTt3QkFDUkEsSUFBSUEsRUFBRUEsSUFBSUE7d0JBQ1ZBLENBQUNBLEVBQUVBLENBQUNBO3dCQUNKQSxDQUFDQSxFQUFFQSxDQUFDQTt3QkFDSkEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7d0JBQ2RBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBO3dCQUNsQkEsSUFBSUEsRUFBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUE7d0JBQ3JEQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxJQUFJQTtxQkFDbkJBLENBQUNBO29CQUNGQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDdENBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO29CQUN0Q0EsSUFBSUE7d0JBQ0FBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO2dCQUNwQkEsQ0FBQ0E7Z0JBRU9QLHNDQUFRQSxHQUFoQkEsVUFBaUJBLElBQUlBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO29CQUN2QlEsRUFBRUEsQ0FBQUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7d0JBQ1RBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO29CQUM3RUEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQ25DQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtvQkFDaEJBLElBQUlBO3dCQUNBQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtnQkFDcEJBLENBQUNBO2dCQUVPUix1Q0FBU0EsR0FBakJBLFVBQWtCQSxJQUFJQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtvQkFDeEJTLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO29CQUNqQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBSUEsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsRUFBTUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsRUFBTUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0E7b0JBQzVFQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxFQUFNQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFXQSxDQUFDQTtvQkFDNUVBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO2dCQUNoQkEsQ0FBQ0E7Z0JBdEtMVDtvQkFBQ0EsbUNBQWVBLENBQUNBLFFBQVFBLENBQUNBO29CQUN6QkEsOEJBQVVBOzt3Q0FzS1ZBO2dCQUFEQSwwQkFBQ0E7WUFBREEsQ0F2S0EsQUF1S0NBLElBQUE7WUF2S0QscURBdUtDLENBQUEiLCJmaWxlIjoiY29yZS9jb21wb25lbnRzL2F0dHJpYnV0ZXMvcGFja2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IGFsZXh2aXpjYWlubyBvbiAyMi8xMi8xNS5cbiAqL1xuaW1wb3J0IHtjdXN0b21BdHRyaWJ1dGUsIGF1dG9pbmplY3R9IGZyb20gJ2F1cmVsaWEtZnJhbWV3b3JrJztcblxuQGN1c3RvbUF0dHJpYnV0ZSgncGFja2VyJylcbkBhdXRvaW5qZWN0XG5leHBvcnQgY2xhc3MgUGFja2VyQ3VzdG9tRWxlbWVudHtcblxuICAgIHB1YmxpYyByb290OiBhbnk7XG5cbiAgICBwdWJsaWMgc29ydGVyID0ge1xuXG4gICAgICAgIHJhbmRvbTogZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpIC0gMC41O1xuICAgICAgICB9LFxuICAgICAgICB3OiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIGIudyAtIGEudztcbiAgICAgICAgfSxcbiAgICAgICAgaDogZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiBiLmggLSBhLmg7XG4gICAgICAgIH0sXG4gICAgICAgIGE6IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5hcmVhIC0gYS5hcmVhO1xuICAgICAgICB9LFxuICAgICAgICBtYXg6IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoYi53LCBiLmgpIC0gTWF0aC5tYXgoYS53LCBhLmgpO1xuICAgICAgICB9LFxuICAgICAgICBtaW46IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oYi53LCBiLmgpIC0gTWF0aC5taW4oYS53LCBhLmgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhlaWdodDogKGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZXIubXNvcnQoYSwgYiwgWydoJywgJ3cnXSk7XG4gICAgICAgIH0pLmJpbmQodGhpcyksXG4gICAgICAgIHdpZHRoOiAoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNvcnRlci5tc29ydChhLCBiLCBbJ3cnLCAnaCddKTtcbiAgICAgICAgfSkuYmluZCh0aGlzKSxcbiAgICAgICAgYXJlYTogKGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZXIubXNvcnQoYSwgYiwgWydhJywgJ2gnLCAndyddKTtcbiAgICAgICAgfSkuYmluZCh0aGlzKSxcbiAgICAgICAgbWF4c2lkZTogKGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZXIubXNvcnQoYSwgYiwgWydtYXgnLCAnbWluJywgJ2gnLCAndyddKTtcbiAgICAgICAgfSkuYmluZCh0aGlzKSxcblxuICAgICAgICBtc29ydDogKGZ1bmN0aW9uIChhLCBiLCBjcml0ZXJpYSkgeyAvKiBzb3J0IGJ5IG11bHRpcGxlIGNyaXRlcmlhICovXG4gICAgICAgICAgICB2YXIgZGlmZiwgbjtcbiAgICAgICAgICAgIGZvciAobiA9IDA7IG4gPCBjcml0ZXJpYS5sZW5ndGg7IG4rKykge1xuICAgICAgICAgICAgICAgIGRpZmYgPSB0aGlzLnNvcnRlcltjcml0ZXJpYVtuXV0oYSwgYik7XG4gICAgICAgICAgICAgICAgaWYgKGRpZmYgIT0gMClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRpZmY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfSkuYmluZCh0aGlzKSxcblxuICAgICAgICBub3c6IGZ1bmN0aW9uKGJsb2Nrcykge1xuICAgICAgICAgICAgYmxvY2tzLnNvcnQodGhpcy5tYXhzaWRlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX2VsZW1lbnQ6IEVsZW1lbnQpe31cblxuICAgIGF0dGFjaGVkKCl7XG4gICAgICAgIHRoaXMucm9vdCA9IHsgeDogMCwgeTogMCwgdzogJCh0aGlzLl9lbGVtZW50KS53aWR0aCgpLCBoOiAkKHRoaXMuX2VsZW1lbnQpLmhlaWdodCgpIH07XG4gICAgICAgIHRoaXMuZml0KHRoaXMuZ2V0VGlsZXModGhpcy5fZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgncGFwZXItY2FyZCcpKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRUaWxlcyhlbGVtZW50cyl7XG4gICAgICAgIHZhciB0aWxlLCB0aWxlcyA9IFtdO1xuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgdGlsZSA9IHtub2RlOiBlbGVtZW50c1tpXSwgdzogJChlbGVtZW50c1tpXSkud2lkdGgoKSwgaDogJChlbGVtZW50c1tpXSkuaGVpZ2h0KCl9XG4gICAgICAgICAgICB0aWxlcy5wdXNoKHRpbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy90aGlzLnNvcnRlci5ub3codGlsZXMpO1xuICAgICAgICB0aWxlcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYS5oID4gYi5oID8gMSA6XG4gICAgICAgICAgICAgICAgYS5oIDwgYi5oID8gLTEgOiAwO1xuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gdGlsZXM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaXQodGlsZXMpe1xuICAgICAgICB2YXIgbiwgbm9kZSwgdGlsZTtcbiAgICAgICAgdGhpcy5yb290ID0geyB4OiAwLCB5OiAwLCB3OiB0aWxlc1swXS53LCBoOiB0aWxlc1swXS5oIH07XG4gICAgICAgIGZvcihuID0gMDsgbiA8IHRpbGVzLmxlbmd0aDsgbisrKXtcbiAgICAgICAgICB0aWxlID0gdGlsZXNbbl07XG4gICAgICAgICAgICBpZihub2RlID0gdGhpcy5maW5kTm9kZSh0aGlzLnJvb3QsIHRpbGUudywgdGlsZS5oKSl7XG4gICAgICAgICAgICAgICAgdGlsZS5maXQgPSB0aGlzLnNwbGl0Tm9kZShub2RlLCB0aWxlLncsIHRpbGUuaCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRpbGUuZml0ID0gdGhpcy5ncm93Tm9kZSh0aWxlLncsIHRpbGUuaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IodmFyIG4gPSAwIDsgbiA8IHRpbGVzLmxlbmd0aCA7IG4rKykge1xuICAgICAgICAgICAgdmFyIHRpbGUgPSB0aWxlc1tuXTtcbiAgICAgICAgICAgIGlmICh0aWxlLmZpdCkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJlbnRPZmZzZXQgPSAkKHRoaXMuX2VsZW1lbnQpLm9mZnNldCgpO1xuICAgICAgICAgICAgICAgICQodGlsZS5ub2RlKS5vZmZzZXQoe2xlZnQ6IHBhcmVudE9mZnNldC5sZWZ0ICsgdGlsZS5maXQueCwgdG9wOiBwYXJlbnRPZmZzZXQudG9wICsgdGlsZS5maXQueX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBncm93Tm9kZSh3LCBoKXtcbiAgICAgICAgdmFyIGNhbkdyb3dEb3duICA9ICh3IDw9IHRoaXMucm9vdC53KTtcbiAgICAgICAgdmFyIGNhbkdyb3dSaWdodCA9IChoIDw9IHRoaXMucm9vdC5oKTtcblxuICAgICAgICB2YXIgc2hvdWxkR3Jvd1JpZ2h0ID0gY2FuR3Jvd1JpZ2h0ICYmICh0aGlzLnJvb3QuaCA+PSAodGhpcy5yb290LncgKyB3KSk7IC8vIGF0dGVtcHQgdG8ga2VlcCBzcXVhcmUtaXNoIGJ5IGdyb3dpbmcgcmlnaHQgd2hlbiBoZWlnaHQgaXMgbXVjaCBncmVhdGVyIHRoYW4gd2lkdGhcbiAgICAgICAgdmFyIHNob3VsZEdyb3dEb3duICA9IGNhbkdyb3dEb3duICAmJiAodGhpcy5yb290LncgPj0gKHRoaXMucm9vdC5oICsgaCkpOyAvLyBhdHRlbXB0IHRvIGtlZXAgc3F1YXJlLWlzaCBieSBncm93aW5nIGRvd24gIHdoZW4gd2lkdGggIGlzIG11Y2ggZ3JlYXRlciB0aGFuIGhlaWdodFxuXG4gICAgICAgIGlmIChzaG91bGRHcm93UmlnaHQpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ncm93UmlnaHQodywgaCk7XG4gICAgICAgIGVsc2UgaWYgKHNob3VsZEdyb3dEb3duKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3Jvd0Rvd24odywgaCk7XG4gICAgICAgIGVsc2UgaWYgKGNhbkdyb3dSaWdodClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdyb3dSaWdodCh3LCBoKTtcbiAgICAgICAgZWxzZSBpZiAoY2FuR3Jvd0Rvd24pXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ncm93RG93bih3LCBoKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7IC8vIG5lZWQgdG8gZW5zdXJlIHNlbnNpYmxlIHJvb3Qgc3RhcnRpbmcgc2l6ZSB0byBhdm9pZCB0aGlzIGhhcHBlbmluZ1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBncm93UmlnaHQodywgaCl7XG4gICAgICAgIHZhciBub2RlO1xuICAgICAgICB0aGlzLnJvb3QgPSB7XG4gICAgICAgICAgICB1c2VkOiB0cnVlLFxuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiB0aGlzLnJvb3QudyArIHcsXG4gICAgICAgICAgICBoOiB0aGlzLnJvb3QuaCxcbiAgICAgICAgICAgIGRvd246IHRoaXMucm9vdCxcbiAgICAgICAgICAgIHJpZ2h0OiB7IHg6IHRoaXMucm9vdC53LCB5OiAwLCB3OiB3LCBoOiB0aGlzLnJvb3QuaCB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChub2RlID0gdGhpcy5maW5kTm9kZSh0aGlzLnJvb3QsIHcsIGgpKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3BsaXROb2RlKG5vZGUsIHcsIGgpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdyb3dEb3duKHcsIGgpe1xuICAgICAgICB2YXIgbm9kZTtcbiAgICAgICAgdGhpcy5yb290ID0ge1xuICAgICAgICAgICAgdXNlZDogdHJ1ZSxcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogdGhpcy5yb290LncsXG4gICAgICAgICAgICBoOiB0aGlzLnJvb3QuaCArIGgsXG4gICAgICAgICAgICBkb3duOiAgeyB4OiAwLCB5OiB0aGlzLnJvb3QuaCwgdzogdGhpcy5yb290LncsIGg6IGggfSxcbiAgICAgICAgICAgIHJpZ2h0OiB0aGlzLnJvb3RcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG5vZGUgPSB0aGlzLmZpbmROb2RlKHRoaXMucm9vdCwgdywgaCkpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zcGxpdE5vZGUobm9kZSwgdywgaCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHByaXZhdGUgZmluZE5vZGUocm9vdCwgdywgaCl7XG4gICAgICAgIGlmKHJvb3QudXNlZClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbmROb2RlKHJvb3QucmlnaHQsIHcsIGgpIHx8IHRoaXMuZmluZE5vZGUocm9vdC5kb3duLCB3LCBoKTtcbiAgICAgICAgZWxzZSBpZigodyA8PSByb290LncpICYmIChoIDw9IHJvb3QuaCkpXG4gICAgICAgICAgICByZXR1cm4gcm9vdDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzcGxpdE5vZGUobm9kZSwgdywgaCl7XG4gICAgICAgIG5vZGUudXNlZCA9IHRydWU7XG4gICAgICAgIG5vZGUuZG93biAgPSB7IHg6IG5vZGUueCwgICAgIHk6IG5vZGUueSArIGgsIHc6IG5vZGUudywgICAgIGg6IG5vZGUuaCAtIGggfTtcbiAgICAgICAgbm9kZS5yaWdodCA9IHsgeDogbm9kZS54ICsgdywgeTogbm9kZS55LCAgICAgdzogbm9kZS53IC0gdywgaDogaCAgICAgICAgICB9O1xuICAgICAgICByZXR1cm4gbm9kZTtcbiAgICB9XG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
